---
title: "Which quantiles of a continuous distribution can one estimate with more precision?
"
author: "Alice"
date: "9/15/2019"
output: 
  html_document: 
    code_folding: hide
    theme: cosmo
    toc: yes
    toc_depth: 5
    toc_float: true
editor_options: 
  chunk_output_type: inline
---


# Which quantiles of a continuous distribution can one estimate with more precision?

Welcome to the world of Probability in Data Science! For any Data Scientist, a student or a practitioner, distribution is a must know concept. It provides the basis for analytics and inferential statistics.

While the concept of probability gives us the mathematical calculations, distributions help us actually visualize whatâ€™s happening underneath.


The median is an important quantity in data analysis. It represents the middle value of the data distribution. Estimates of the median, however, have a degree of uncertainty because (a) the estimates are calculated from a finite sample and (b) the data distribution of the underlying data is generally unknown. One important roles of a data scientist is to quantify and to communicate the degree of uncertainty in his or her data analysis.


Today we are going to discuss 4 types of distributions.

The sampling distribution for the quantiles is generated by repeatedly calculating the quantiles from random samples of size N. Firstly, let our sample N=200. Calculate the length of the middle 95% of the sampling distribution by calculating the difference between 2.5% and 97.5% percentiles of the sampling distribution. And sumilate 5000 times.

Quantiles: The quantile of order p or pth quantile (0<p<1) is a value of the variable which divides the whole frequency distribution in two parts such that p-proportion of the total number of observations are less than or equal to it and (1-p) proportion of the total number of observations are greater than it.


```{r}
p <- seq(.05,.95,by=.05)

middle.95 <- function(FUN1,FUN2,FUN3, N=200, draws=5000){
  pthquan <- matrix(NA, nrow=draws,ncol = length(p))  
  for (i in 1:draws) {
   dist <- FUN1(N)
   pthquan[i,] <- quantile(dist,p)
  }
  
  colnames(pthquan) <- p
  mid.len <- rep(NA,ncol(pthquan))
  
  for (j in 1:ncol(pthquan)) {
    mid.len[j] <- quantile(pthquan[,j], 0.975) - quantile(pthquan[,j], 0.025)
}
  
  return(pthquan)
}

```

# Distribution 1

Use the standard normal distribution.

```{r}
mid.mat.norm <- middle.95(FUN1=rnorm,FUN2=qnorm,FUN3=dnorm)

mid.len <- rep(NA,ncol(mid.mat.norm))
 for (j in 1:ncol(mid.mat.norm)) {
  mid.len[j] <- quantile(mid.mat.norm[,j],0.975) - quantile(mid.mat.norm[,j],0.025)
 }

plot(p, mid.len,xlab = "pth quantile",ylab = "Length",main = "Length of the middle 95% of the sampling distribution",type = "p")
  
plot(dnorm(qnorm(p)), mid.len, xlab = "Density",ylab = "Length",main = "Length of the middle 95% of the sampling distribution by density",type = "p")
```



# Distribution 2
```{r}
mid.mat.exp <- middle.95(FUN1=rexp,FUN2=qexp,FUN3=dexp)

mid.len.exp <- rep(NA,ncol(mid.mat.exp))
 for (j in 1:ncol(mid.mat.exp)) {
  mid.len.exp[j] <- quantile(mid.mat.exp[,j],0.975) - quantile(mid.mat.exp[,j],0.025)
 }

plot(p, mid.len.exp,xlab = "pth quantile",ylab = "Length",main = "Length of the middle 95% of the sampling distribution",type = "p")

plot(dexp(qexp(p)), mid.len.exp, xlab = "Density",ylab = "Length",main = "Length of the middle 95% of the sampling distribution by density",type = "p")


```

# Distribution 3
```{r}
rf3 <- function(N){
  G <- sample(0:2, N, replace = TRUE, prob = c(5,3,2))
  (G==0)*rnorm(N) + (G==1)*rnorm(N,4) + (G==2)*rnorm(N,-4,2)
}

pf3 <- function(x){
  .5*pnorm(x) + .3*pnorm(x,4) + .2*pnorm(x,-4,2)
}

df3 <- function(x){
  .5*dnorm(x) + .3*dnorm(x,4) + .2*dnorm(x,-4,2)
}
```

```{r}
mid.mat.df3 <- middle.95(FUN1=rf3,FUN3=df3)

mid.len.df3 <- rep(NA,ncol(mid.mat.df3))
 for (j in 1:ncol(mid.mat.df3)) {
  mid.len.df3[j] <- quantile(mid.mat.df3[,j],0.975) - quantile(mid.mat.df3[,j],0.025)
 }

plot(p, mid.len.df3,xlab = "pth quantile",ylab = "Length",main = "Length of the middle 95% of the sampling distribution",type = "p")



```

```{r}
rf3 <- function(N){
  G <- sample(0:2, N, replace = TRUE, prob = c(5,3,2))
  (G==0)*rnorm(N) + (G==1)*rnorm(N,4) + (G==2)*rnorm(N,-4,2)
}

pf3 <- function(x){
  .5*pnorm(x) + .3*pnorm(x,4) + .2*pnorm(x,-4,2)
}

df3 <- function(x){
  .5*dnorm(x) + .3*dnorm(x,4) + .2*dnorm(x,-4,2)
}


plot(dexp(qexp(p)), mid.len.exp, xlab = "Density",ylab = "Length",main = "Length of the middle 95% of the sampling distribution by density",type = "p")

```


```{r}
qf3_seq <- rep(NA, length(p))
for (i in seq_along(p)) {
  qf3_seq[i] <- uniroot(function(x){pf3(x)-p[i]},c(-200,200))[[1]]
}

plot(df3(qf3_seq), mid.len.df3, xlab = "Density",ylab = "Length",main = "Length of the middle 95% of the sampling distribution by density",type = "p")


```

# Distribution 4
```{r}
rf4 <- function(N){
  G <- sample(0:1, N, replace = TRUE)
  (G==0)*rbeta(N,5,1) + (G==1)*rbeta(N,1,5)
}

pf4 <- function(x){
  .5*pbeta(x,5,1) + .5*pbeta(x,1,5) 
}

df4 <- function(x){
  .5*dbeta(x,5,1) + .5*dbeta(x,1,5) 
}

mid.mat.df4 <- middle.95(FUN1=rf4,FUN3=df4)

mid.len.df4 <- rep(NA,ncol(mid.mat.df4))
 for (j in 1:ncol(mid.mat.df4)) {
  mid.len.df4[j] <- quantile(mid.mat.df4[,j],0.975) - quantile(mid.mat.df4[,j],0.025)
 }

plot(p, mid.len.df4,xlab = "pth quantile",ylab = "Length",main = "Length of the middle 95% of the sampling distribution",type = "p")
```


```{r}
qf4_seq <- rep(NA, length(p))
for (i in seq_along(p)) {
  qf4_seq[i] <- uniroot(function(x){pf4(x)-p[i]},c(-200,200))[[1]]
}

plot(df4(qf4_seq), mid.len.df4, xlab = "Density",ylab = "Length",main = "Length of the middle 95% of the sampling distribution by density",type = "p")

```

As we can see from the graphs of different distributions, the first distribution, which is the standard normal distribution, has the tightest distribution beause it has the smallest range in length. It also means the standard normal distribution has more precision because of its tightness. Thus we can also say distribution 3 has the leaset precision.

# Simulation
for Distribution 1, simulate with N=400,800,1600

```{r}
p <- seq(.05,.95,by=.05)

mid.mat.norm.400 <- middle.95(FUN1=rnorm,FUN2=qnorm,FUN3=dnorm,N=400)
mid.len.400 <- rep(NA,ncol(mid.mat.norm.400))
 for (j in 1:ncol(mid.mat.norm.400)) {
  mid.len.400[j] <- quantile(mid.mat.norm.400[,j],0.975) - quantile(mid.mat.norm.400[,j],0.025)
 }

mid.mat.norm.800 <- middle.95(FUN1=rnorm,FUN2=qnorm,FUN3=dnorm,N=800)
mid.len.800 <- rep(NA,ncol(mid.mat.norm.800))
 for (j in 1:ncol(mid.mat.norm.800)) {
  mid.len.800[j] <- quantile(mid.mat.norm.800[,j],0.975) - quantile(mid.mat.norm.800[,j],0.025)
 }

mid.mat.norm.1600 <- middle.95(FUN1=rnorm,FUN2=qnorm,FUN3=dnorm,N=1600)
mid.len.1600 <- rep(NA,ncol(mid.mat.norm.1600))
 for (j in 1:ncol(mid.mat.norm.1600)) {
  mid.len.1600[j] <- quantile(mid.mat.norm.1600[,j],0.975) - quantile(mid.mat.norm.1600[,j],0.025)
 }

plot.new()
plot(p, mid.len.400,ylim=c(0.1,0.45),xlab = "pth quantile",ylab = "Length",main = "Length of the middle 95% of the sampling distribution",type = "p",col="green")
#par(no.readonly = T)
points(p, mid.len.800,col="red")
points(p,mid.len.1600,col="blue")
legend("topleft",legend = c("N=400","N=800","N=1600"),col=c("green","red","blue"), lwd = 3, bty = "n")
#plot(p, mid.len.800,xlab = "pth quantile",ylab = "Length",main = "Length of the middle 95% of the sampling distribution",type = "p")
#plot(p, mid.len.1600,xlab = "pth quantile",ylab = "Length",main = "Length of the middle 95% of the sampling distribution",type = "p")
```


